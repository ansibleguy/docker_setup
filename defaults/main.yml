---
# see: https://docs.docker.com/engine/install/debian/

docker: {}

defaults_docker:
  server: true
  compose: false
  compose_version: '2.9'
  listen_tcp:
    enable: false
    port: 2375
    bind: '0.0.0.0'

CONFIG_DOCKER: "{{ defaults_docker | combine(docker, recursive=true) }}"

compose_version_fixed: "{% if CONFIG_DOCKER.compose_version[0] not in ['1', 'v'] %}v{{ CONFIG_DOCKER.compose_version }}{% endif %}"

DOCKER_HC:
  dependencies:
    - 'apt-transport-https'
    - 'ca-certificates'
    - 'gnupg'
    - 'curl'
    - 'systemd'

  repo:
    pub_url: "https://download.docker.com/linux/{{ ansible_distribution|lower }}/gpg"
    pub_hash: 'sha256:1500c1f56fa9e26b9b8f42452a553675796ade0807cdce11975eb98170b3a570'
    pub_file: '/usr/share/keyrings/docker-archive-keyring.gpg'
    source: "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg]
    https://download.docker.com/linux/{{ ansible_distribution|lower }} {{ ansible_distribution_release }} stable"

  packages:
    server:
    - 'docker-ce'
    - 'containerd.io'
    client:
      - 'docker-ce-cli'

  compose_url: "https://github.com/docker/compose/releases/download/{{ compose_version_fixed }}/docker-compose-Linux-x86_64"
